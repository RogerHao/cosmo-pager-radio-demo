# 硬件架构设计

## 概述

本项目将 E5 Ultra 安卓掌机改造为桌面式 Radio 接收器，核心思路是：
1. 保留 E5 Ultra 的屏幕、主板、电池
2. 移除原有物理按键
3. 通过 ESP32 蓝牙 HID 实现自定义输入
4. 3D 打印新外壳，实现 iMac G3 风格造型

## 系统架构

```
┌─────────────────────────────────────────────────────────┐
│                    3D 打印外壳                           │
│  ┌─────────────────────────────────────────────────┐   │
│  │                  E5 Ultra                        │   │
│  │  ┌───────────────────────────────────────────┐  │   │
│  │  │            5寸 IPS 屏幕                    │  │   │
│  │  │   ○ 模式    ◉ 主显示区    ○ 频率         │  │   │
│  │  └───────────────────────────────────────────┘  │   │
│  │               Android 系统                       │   │
│  │               蓝牙 HID Host                      │   │
│  └──────────────────┬──────────────────────────────┘   │
│                     │ 蓝牙                              │
│  ┌──────────────────┴──────────────────────────────┐   │
│  │           Adafruit HUZZAH32 (ESP32)             │   │
│  │               蓝牙 HID Device                    │   │
│  └────┬─────────────┬─────────────────┬────────────┘   │
│       │             │                 │                 │
│   ┌───┴───┐    ┌────┴────┐      ┌────┴────┐           │
│   │ EC11  │    │  EC11   │      │ 微动开关 │           │
│   │频率旋钮│    │模式旋钮 │      │顶部按钮  │           │
│   └───────┘    └─────────┘      └─────────┘           │
└─────────────────────────────────────────────────────────┘
```

## E5 Ultra 改造

### 保留部件
- 5寸 IPS 全贴屏（1280x720，60Hz）
- T620 主板及芯片组
- 5000mAh 电池
- USB-C 充电接口
- WiFi/蓝牙模块

### 移除部件
- 后壳
- 下方物理按键区域（摇杆、D-pad、ABXY 按钮等）
- 原有输入控制板

### 改造要点
- 只保留前壳+屏幕+主板组件
- 前壳将贴合在新 3D 打印外壳的正面
- 从主板测试点取电为 ESP32 供电

## ESP32 蓝牙 HID 方案

### 控制器选型
选用 Adafruit HUZZAH32 - ESP32 Feather，原因：
- ESP32 双模蓝牙，支持 Classic BT 和 BLE
- 内置电池管理，BAT 引脚支持锂电池直连
- 体积小巧，便于内置
- ESP-IDF 开发生态成熟

### 输入设备映射

| 输入设备 | 硬件接口 | HID 映射 |
|----------|----------|----------|
| EC11 #1 | 旋转编码器 A/B 相 | 上/下方向键 |
| EC11 #2 | 旋转编码器 A/B 相 | 左/右方向键 |
| 顶部按钮 | 微动开关 | Enter 键 |

### 通信协议
- 使用蓝牙 HID 协议（Human Interface Device）
- ESP32 作为 HID Device（键盘）
- E5 Ultra Android 系统作为 HID Host
- 配对后自动连接，模拟标准键盘输入

## 供电方案

### 电源来源
从 E5 Ultra 主板测试点取电，输出电压约 3.5~3.7V（电池电压）

### 接入方式
- 电源正极接入 HUZZAH32 的 BAT 引脚
- BAT 引脚额定输入范围：3.5V - 4.2V
- 共地连接

### 充电
- E5 Ultra 原有 USB-C 接口保留
- 通过 USB-C 为整机充电
- ESP32 随 E5 Ultra 一同开关机

## 外壳设计

### 设计风格
- 参考 iMac G3 的斜面站立式造型
- 屏幕面板向后倾斜，便于桌面使用
- 底部加宽作为稳定支撑

### 三圆形遮罩设计
利用 E5 Ultra 的 5 寸矩形屏幕，通过外壳开孔实现三个圆形显示区：
- **中间大圆**: 主显示区，展示核心内容
- **左侧小圆**: 模式指示区
- **右侧小圆**: 频率指示区

软件界面需配合此遮罩设计，在对应位置显示相应内容。

### 开孔布局
- 正面上部：三个圆形开孔（屏幕区域）
- 正面下部：两个圆形开孔（EC11 旋钮）
- 顶部：条状开槽（顶部按钮）
- 背部/底部：USB-C 充电口、散热孔

### 制造工艺
- Fusion 360 建模
- FDM 3D 打印
- 建议使用 PLA 或 PETG 材料

## 后续开发

1. **ESP32 固件**: 使用 ESP-IDF 开发蓝牙 HID 键盘固件
2. **外壳迭代**: 根据实际装配情况调整 3D 模型
3. **整机组装**: 布线、固定、测试
